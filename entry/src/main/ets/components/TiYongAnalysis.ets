/**
 * ä½“ç”¨ç»¼åˆåˆ†æç»„ä»¶
 * å°†Aæ³•ï¼ˆä½“ï¼‰å’ŒBæ³•ï¼ˆç”¨ï¼‰ç»“æœè¿›è¡Œç»¼åˆåˆ¤æ–­
 */
import { TiYongAnalysisResult, ZhengTongGuaResult, NianGanGuaResult } from '../model/HeluoModels';

@Component
export struct TiYongAnalysis {
  @Prop tiYong: TiYongAnalysisResult = new TiYongAnalysisResult();
  @Prop zhengTong: ZhengTongGuaResult = new ZhengTongGuaResult();
  @Prop nianGan: NianGanGuaResult = new NianGanGuaResult();

  build() {
    Column() {
      // æ ‡é¢˜
      Text('ä½“ç”¨åˆå‚Â·ç»¼åˆæ–­äº‹')
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .fontColor('#4A0080')
        .margin({ bottom: 12 })

      // ä½“ç”¨å¯¹ç…§è¡¨
      Row() {
        // ä½“ï¼ˆå…ˆå¤©å‘½å¦ï¼‰
        Column() {
          Text('ä½“')
            .fontSize(12)
            .fontColor('#666')
          Text('å…ˆå¤©å‘½å¦')
            .fontSize(11)
            .fontColor('#999')
            .margin({ top: 2 })

          Text(this.zhengTong.mingGua.unicode)
            .fontSize(36)
            .fontColor('#8B4513')
            .margin({ top: 4 })

          Text(this.zhengTong.mingGua.name)
            .fontSize(14)
            .fontWeight(FontWeight.Medium)
            .fontColor('#333')

          this.buildLuckBadge(this.tiYong.tiLuck)
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Center)
        .padding(12)
        .backgroundColor('#FFF8F0')
        .borderRadius(12)

        // åŠ å·
        Column() {
          Text('+')
            .fontSize(24)
            .fontColor('#999')
        }
        .padding({ left: 8, right: 8 })

        // ç”¨ï¼ˆåå¤©å˜å¦ï¼‰
        Column() {
          Text('ç”¨')
            .fontSize(12)
            .fontColor('#666')
          Text('åå¤©å˜å¦')
            .fontSize(11)
            .fontColor('#999')
            .margin({ top: 2 })

          Text(this.nianGan.bianGua.unicode)
            .fontSize(36)
            .fontColor('#1E4D8C')
            .margin({ top: 4 })

          Text(this.nianGan.bianGua.name)
            .fontSize(14)
            .fontWeight(FontWeight.Medium)
            .fontColor('#333')

          this.buildLuckBadge(this.tiYong.yongLuck)
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Center)
        .padding(12)
        .backgroundColor('#F0F7FF')
        .borderRadius(12)

        // ç­‰å·
        Column() {
          Text('=')
            .fontSize(24)
            .fontColor('#999')
        }
        .padding({ left: 8, right: 8 })

        // ç»¼åˆç»“æœ
        Column() {
          Text('ç»¼åˆ')
            .fontSize(12)
            .fontColor('#666')

          Text(this.tiYong.combinedResult)
            .fontSize(32)
            .fontWeight(FontWeight.Bold)
            .fontColor(this.getCombinedColor())
            .margin({ top: 8 })

          Text(this.getCombinedEmoji())
            .fontSize(24)
            .margin({ top: 4 })
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Center)
        .padding(12)
        .backgroundColor(this.getCombinedBgColor())
        .borderRadius(12)
      }
      .width('100%')
      .margin({ bottom: 16 })

      // ç»¼åˆæè¿°
      Column() {
        Text('ã€ç»¼åˆåˆ¤æ–­ã€‘')
          .fontSize(14)
          .fontWeight(FontWeight.Medium)
          .fontColor('#4A0080')
          .alignSelf(ItemAlign.Start)
          .margin({ bottom: 8 })

        Text(this.tiYong.combinedDesc)
          .fontSize(15)
          .fontColor('#333')
          .lineHeight(22)
          .width('100%')
      }
      .width('100%')
      .padding(12)
      .backgroundColor('#FAF5FF')
      .borderRadius(8)
      .margin({ bottom: 12 })

      // å»ºè®®
      Column() {
        Text('ã€è¡ŒåŠ¨å»ºè®®ã€‘')
          .fontSize(14)
          .fontWeight(FontWeight.Medium)
          .fontColor('#4A0080')
          .alignSelf(ItemAlign.Start)
          .margin({ bottom: 8 })

        Text(this.tiYong.advice)
          .fontSize(14)
          .fontColor('#666')
          .lineHeight(20)
          .width('100%')
      }
      .width('100%')
      .padding(12)
      .backgroundColor('#F5F0FF')
      .borderRadius(8)
      .margin({ bottom: 12 })

      // ä½“ç”¨å…³ç³»è¯´æ˜
      Column() {
        Text('ã€ä½“ç”¨å…³ç³»ã€‘')
          .fontSize(13)
          .fontWeight(FontWeight.Medium)
          .fontColor('#888')
          .alignSelf(ItemAlign.Start)
          .margin({ bottom: 6 })

        Text('ä½“å¦ç®¡"èƒ½ä¸èƒ½æˆ"â€”â€”å…ˆå¤©æ ¼å±€é«˜ä½ã€æ ¹åŸºæ·±æµ…')
          .fontSize(12)
          .fontColor('#999')
          .margin({ bottom: 4 })

        Text('ç”¨å¦ç®¡"æ€ä¹ˆæˆã€ä½•æ—¶æˆ"â€”â€”å®ç°è·¯å¾„ã€åº”æœŸæ—¶æœº')
          .fontSize(12)
          .fontColor('#999')
      }
      .width('100%')
      .padding(10)
      .backgroundColor('#F8F8F8')
      .borderRadius(8)
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#FFFFFF')
    .borderRadius(16)
    .shadow({ radius: 4, color: '#1A000000', offsetX: 0, offsetY: 2 })
  }

  @Builder
  buildLuckBadge(luck: string) {
    Text(luck === 'å‰' ? 'å‰' : (luck === 'å‡¶' ? 'å‡¶' : 'å¹³'))
      .fontSize(11)
      .fontColor('#FFF')
      .padding({ left: 6, right: 6, top: 2, bottom: 2 })
      .backgroundColor(this.getLuckColor(luck))
      .borderRadius(8)
      .margin({ top: 4 })
  }

  getLuckColor(luck: string): string {
    if (luck === 'å‰') return '#C41E3A';
    if (luck === 'å‡¶') return '#4A4A4A';
    return '#888888';
  }

  getCombinedColor(): string {
    if (this.tiYong.combinedResult === 'å¤§å‰') return '#C41E3A';
    if (this.tiYong.combinedResult === 'å¤§å‡¶') return '#4A4A4A';
    return '#666666';
  }

  getCombinedBgColor(): string {
    if (this.tiYong.combinedResult === 'å¤§å‰') return '#FFF0F0';
    if (this.tiYong.combinedResult === 'å¤§å‡¶') return '#F0F0F0';
    return '#FFFFF0';
  }

  getCombinedEmoji(): string {
    if (this.tiYong.combinedResult === 'å¤§å‰') return 'ğŸ‰';
    if (this.tiYong.combinedResult === 'å¤§å‡¶') return 'âš ï¸';
    return 'âš–ï¸';
  }
}
